## Back-End API (Express + TypeScript + Prisma)

### Overview
A RESTful API built with Express 5 and TypeScript, using Prisma as the ORM for a PostgreSQL database. The service manages core resources like shops, users, types, categories, items, order lists, list items, and orders. Logging is handled via Winston with request logging from Morgan.

### Tech Stack
- **Runtime**: Node.js
- **Framework**: Express 5
- **Language**: TypeScript 5
- **ORM**: Prisma (PostgreSQL)
- **Logging**: Winston + Morgan
- **Env**: dotenv

### Prerequisites
- **Node.js** 18+ (20+ recommended)
- **npm** (comes with Node)
- **PostgreSQL** running and reachable

### Getting Started
1. **Clone and install**
   ```bash
   npm install
   ```
2. **Environment variables**
   Create a `.env` at the project root. You can start from `.env copy`:
   ```bash
   cp ".env copy" .env
   ```
   Update values as needed (see Environment section below).
3. **Generate Prisma client and ERD**
   ```bash
   npx prisma generate
   ```
4. **Apply database migrations**
   ```bash
   npx prisma migrate dev
   # or to reset/apply from scratch
   # npx prisma migrate reset
   ```
5. **Run in development**
   ```bash
   npm run dev
   ```
6. **Build & start (production)**
   ```bash
   npm run build
   npm start
   ```

### Scripts
- **dev**: `ts-node-dev` runs `src/main.ts` with fast reload
- **build**: TypeScript compile to `dist`
- **start**: run compiled app from `dist/main.js`

### Environment
The app requires these variables (validated on startup):

- **PORT**: Port for the HTTP server (e.g., `5000`)
- **ENV**: Environment name (e.g., `Development`, `Production`)
- **DATABASE_URL**: PostgreSQL connection string, e.g.
  ```
  postgresql://USER:PASSWORD@HOST:5432/DB_NAME?schema=public
  ```

Example `.env` (do not commit):
```env
DATABASE_URL="postgresql://postgres:password@localhost:5432/e_cafe_db?schema=public"
PORT=5000
ENV=Development
```

### Running
- Root health endpoint:
  ```
  GET /
  -> { "message": "Server is running on port: <PORT>" }
  ```
- API base path: `http://localhost:<PORT>/api/v1`

### API Routes
Each resource exposes standard CRUD endpoints under the base path.

- **/shops**
  - GET `/` — list
  - GET `/:id` — detail
  - POST `/` — create
  - PUT `/:id` — update
  - DELETE `/:id` — remove
- **/users**
  - GET `/`, GET `/:id`, POST `/`, PUT `/:id`, DELETE `/:id`
- **/types**
  - GET `/`, GET `/:id`, POST `/`, PUT `/:id`, DELETE `/:id`
- **/categories**
  - GET `/`, GET `/:id`, POST `/`, PUT `/:id`, DELETE `/:id`
- **/items**
  - GET `/`, GET `/:id`, POST `/`, PUT `/:id`, DELETE `/:id`
- **/order-lists**
  - GET `/`, GET `/:id`, POST `/`, PUT `/:id`, DELETE `/:id`
- **/list-items**
  - GET `/`, GET `/:id`, POST `/`, PUT `/:id`, DELETE `/:id`
- **/orders**
  - GET `/`, GET `/:id`, POST `/`, PUT `/:id`, DELETE `/:id`

Quick example:
```bash
curl http://localhost:5000/api/v1/shops
```

### Data Model & Prisma
- Prisma schema: `prisma/schema.prisma`
- Generated client output: `src/generated/prisma`
- ERD image (generated by prisma-erd-generator): `prisma/ERD.png`

Common commands:
```bash
# After editing schema.prisma
npx prisma generate

# Create a new migration
npx prisma migrate dev --name <change_name>

# Apply migrations to an existing DB without prompts
npx prisma migrate deploy
```

### Logging
- Console logs and files under `logs/`:
  - `logs/combined.log`
  - `logs/error.log`
- HTTP request logs via Morgan are routed into Winston at the `http` level.

### Project Structure
```
src/
  config/
    config.ts
  controllers/
    *.controller.ts
  middlewares/
    requestLogger.ts
  routes/
    *.routes.ts       # mounted under /api/v1
  services/
    *.service.ts
  utils/
    logger.ts
    response.ts
    handlePrimaErrors.ts
  main.ts
prisma/
  schema.prisma
  ERD.md
  ERD.png
  migrations/
```

### License
ISC
